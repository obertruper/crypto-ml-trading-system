#!/bin/bash

# Post-edit hook –¥–ª—è ML Crypto Trading –ø—Ä–æ–µ–∫—Ç–∞
# –í—ã–ø–æ–ª–Ω—è–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ—Å–ª–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤

TOOL_NAME="$1"
FILE_PATH="$2"
EXIT_CODE="$3"

LOG_FILE="/mnt/SSD/PYCHARMPRODJECT/LLM TRANSFORM/crypto_ai_trading/logs/hooks.log"
echo "[$(date)] POST-EDIT: Tool=$TOOL_NAME, File=$FILE_PATH, ExitCode=$EXIT_CODE" >> "$LOG_FILE"

# –ï—Å–ª–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å, –≤—ã—Ö–æ–¥–∏–º
if [ "$EXIT_CODE" != "0" ]; then
    exit 0
fi

# –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø —Ñ–∞–π–ª–∞ –∏ –≤—ã–ø–æ–ª–Ω—è–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
if [[ "$FILE_PATH" == *.py ]]; then
    # –î–ª—è Python —Ñ–∞–π–ª–æ–≤ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å–∏–Ω—Ç–∞–∫—Å–∏—Å
    echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ Python —Ñ–∞–π–ª–∞..."
    
    cd "/mnt/SSD/PYCHARMPRODJECT/LLM TRANSFORM/crypto_ai_trading"
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–∏–Ω—Ç–∞–∫—Å–∏—Å
    python -m py_compile "$FILE_PATH" 2>/dev/null
    if [ $? -ne 0 ]; then
        echo "‚ùå –û–®–ò–ë–ö–ê: –°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –≤ —Ñ–∞–π–ª–µ $FILE_PATH"
        echo "üí° –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø—Ä–∞–≤–∏—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏"
    fi
    
    # –ï—Å–ª–∏ —ç—Ç–æ —Ñ–∞–π–ª –º–æ–¥–µ–ª–∏, –Ω–∞–ø–æ–º–∏–Ω–∞–µ–º –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    if [[ "$FILE_PATH" == *"models/"* ]] || [[ "$FILE_PATH" == *"train"* ]]; then
        echo "üìä –§–∞–π–ª –º–æ–¥–µ–ª–∏ –∏–∑–º–µ–Ω–µ–Ω. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:"
        echo "   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ —á–µ–∫–ø–æ–∏–Ω—Ç–∞–º–∏"
        echo "   - –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã –º–æ–¥–µ–ª–∏"
        echo "   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ config.yaml"
    fi
    
elif [[ "$FILE_PATH" == *.yaml ]] || [[ "$FILE_PATH" == *.yml ]]; then
    # –î–ª—è YAML —Ñ–∞–π–ª–æ–≤ –ø—Ä–æ–≤–µ—Ä—è–µ–º –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å
    echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ YAML –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏..."
    
    python -c "import yaml; yaml.safe_load(open('$FILE_PATH'))" 2>/dev/null
    if [ $? -ne 0 ]; then
        echo "‚ùå –û–®–ò–ë–ö–ê: –ù–µ–≤–∞–ª–∏–¥–Ω—ã–π YAML –≤ —Ñ–∞–π–ª–µ $FILE_PATH"
    else
        echo "‚úÖ YAML –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤–∞–ª–∏–¥–Ω–∞"
    fi
fi

# –î–ª—è –≤–∞–∂–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –≤—ã–≤–æ–¥–∏–º –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –∫–æ–º–º–∏—Ç–µ
IMPORTANT_FILES=("models/" "train" "config/" "trading/signals.py" "main.py")
for pattern in "${IMPORTANT_FILES[@]}"; do
    if [[ "$FILE_PATH" == *"$pattern"* ]]; then
        echo "üìù –í–∞–∂–Ω—ã–π —Ñ–∞–π–ª –∏–∑–º–µ–Ω–µ–Ω. –ù–µ –∑–∞–±—É–¥—å—Ç–µ –∑–∞–∫–æ–º–º–∏—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏!"
        break
    fi
done

exit 0