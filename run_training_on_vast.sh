#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –æ–±—É—á–µ–Ω–∏—è –Ω–∞ Vast.ai —Å –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î

echo "üöÄ –ó–∞–ø—É—Å–∫ –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–∏ –Ω–∞ Vast.ai"
echo "===================================="

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î..."
if ! pg_isready -p 5555 -h localhost > /dev/null 2>&1; then
    echo "‚ùå PostgreSQL –Ω–µ –∑–∞–ø—É—â–µ–Ω –ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ –ø–æ—Ä—Ç—É 5555!"
    echo "–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ë–î –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞."
    exit 1
fi
echo "‚úÖ –õ–æ–∫–∞–ª—å–Ω–∞—è –ë–î –¥–æ—Å—Ç—É–ø–Ω–∞"

# –ú–µ–Ω—é –≤—ã–±–æ—Ä–∞
echo ""
echo "–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º –æ–±—É—á–µ–Ω–∏—è:"
echo "1) Regression (–ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏)"
echo "2) Classification (–ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ profit/loss)"
echo "3) –í–°–Å - –æ–±—É—á–∏—Ç—å –æ–±–µ –º–æ–¥–µ–ª–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ ‚≠ê"
echo "4) –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞—Ç–∞—Å–µ—Ç–∞"
echo "5) –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ–±—É—á–µ–Ω–∏—è"
echo ""
read -p "–í–∞—à –≤—ã–±–æ—Ä (1-5): " choice

case $choice in
    1)
        echo ""
        echo "üß† –ó–∞–ø—É—Å–∫–∞—é –æ–±—É—á–µ–Ω–∏–µ –≤ —Ä–µ–∂–∏–º–µ REGRESSION..."
        echo "–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –Ω–æ–≤–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ: ./setup_remote_db_tunnel.sh"
        echo "–¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç—É–Ω–Ω–µ–ª—è –∫ –ë–î"
        echo ""
        read -p "–ù–∞–∂–º–∏—Ç–µ Enter –∫–æ–≥–¥–∞ —Ç—É–Ω–Ω–µ–ª—å –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω..."
        
        ssh -p 27681 root@79.116.73.220 -t "cd /workspace/crypto_trading && source /workspace/venv/bin/activate && export TF_CPP_MIN_LOG_LEVEL=1 && python train_universal_transformer.py --config remote_config.yaml"
        ;;
    2)
        echo ""
        echo "‚ùå –†–µ–∂–∏–º Classification –±–æ–ª—å—à–µ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è"
        echo "–ú–æ–¥–µ–ª—å —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤ —Ä–µ–∂–∏–º–µ —Ä–µ–≥—Ä–µ—Å—Å–∏–∏"
        echo "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–ø—Ü–∏—é 1 –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –æ–±—É—á–µ–Ω–∏—è"
        ;;
    3)
        echo ""
        echo "üöÄ –ó–∞–ø—É—Å–∫–∞—é –æ–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π —Ä–µ–≥—Ä–µ—Å—Å–∏–∏..."
        echo "–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –Ω–æ–≤–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ: ./setup_remote_db_tunnel.sh"
        echo "–¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç—É–Ω–Ω–µ–ª—è –∫ –ë–î"
        echo ""
        read -p "–ù–∞–∂–º–∏—Ç–µ Enter –∫–æ–≥–¥–∞ —Ç—É–Ω–Ω–µ–ª—å –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω..."
        
        echo "üß† –ó–∞–ø—É—Å–∫–∞—é –æ–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π —Ä–µ–≥—Ä–µ—Å—Å–∏–∏..."
        ssh -p 27681 root@79.116.73.220 -t "cd /workspace/crypto_trading && source /workspace/venv/bin/activate && export TF_CPP_MIN_LOG_LEVEL=1 && python train_universal_transformer.py --config remote_config.yaml"
        
        echo ""
        echo "‚úÖ –ü–æ–ª–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!"
        ;;
    4)
        echo ""
        echo "üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞—Ç–∞—Å–µ—Ç–∞..."
        ssh -p 27681 root@79.116.73.220 -t "cd /workspace/crypto_trading && source /workspace/venv/bin/activate && python check_dataset_status.py"
        ;;
    5)
        echo ""
        echo "üìà –ó–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞..."
        ssh -p 27681 root@79.116.73.220 -t "cd /workspace/crypto_trading && source /workspace/venv/bin/activate && python monitor_training.py"
        ;;
    *)
        echo "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä!"
        exit 1
        ;;
esac