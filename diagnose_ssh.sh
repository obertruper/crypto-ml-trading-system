#!/bin/bash
# –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Vast.ai

echo "üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Vast.ai"
echo "========================================"

# –ü–∞—Ä–∞–º–µ—Ç—Ä—ã
HOST="79.116.73.220"
PORT="27681"
USER="root"

echo ""
echo "üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ SSH –∫–ª—é—á–µ–π:"
echo "-----------------------"

# –°–ø–∏—Å–æ–∫ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –∫–ª—é—á–µ–π
SSH_KEYS=(
    "$HOME/.ssh/id_rsa"
    "$HOME/.ssh/id_ed25519"
    "$HOME/.ssh/vast_ai_key"
    "./vast_ssh_key_fixed.txt"
)

for key in "${SSH_KEYS[@]}"; do
    if [ -f "$key" ]; then
        echo "‚úÖ –ù–∞–π–¥–µ–Ω: $key"
        ls -la "$key"
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á
        if [ -f "${key}.pub" ]; then
            echo "   –ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á:"
            head -c 50 "${key}.pub"
            echo "..."
        fi
    else
        echo "‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω: $key"
    fi
    echo ""
done

echo ""
echo "üìã SSH Config:"
echo "--------------"
if [ -f ~/.ssh/config ]; then
    grep -A10 -B2 "vast\|79.116" ~/.ssh/config || echo "–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π –¥–ª—è Vast.ai"
else
    echo "‚ùå –§–∞–π–ª ~/.ssh/config –Ω–µ –Ω–∞–π–¥–µ–Ω"
fi

echo ""
echo "üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Å —Ä–∞–∑–Ω—ã–º–∏ –æ–ø—Ü–∏—è–º–∏:"
echo "----------------------------------------"

# –ü—Ä–æ–±—É–µ–º –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
echo ""
echo "1. –ü—Ä–æ–±—É—é —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π 5 —Å–µ–∫—É–Ω–¥..."
sleep 5

ssh -v -o ConnectTimeout=30 -o StrictHostKeyChecking=no -p "$PORT" "$USER@$HOST" "echo 'TEST OK'" 2>&1 | grep -E "Offering|Trying|Authentication|Permission denied" | head -20

echo ""
echo "üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:"
echo "----------------"
echo "1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä Vast.ai –∑–∞–ø—É—â–µ–Ω: https://vast.ai/console/instances/"
echo "2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ SSH –∫–ª—é—á–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç–µ: https://vast.ai/console/account/"
echo "3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∞–∫—Ç—É–∞–ª—å–Ω—É—é –∫–æ–º–∞–Ω–¥—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏–∑ –∫–æ–Ω—Å–æ–ª–∏ Vast.ai"
echo ""
echo "–ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ:"
echo "- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∏–Ω—Å—Ç–∞–Ω—Å"
echo "- –î–æ–±–∞–≤–∏—Ç—å SSH –∫–ª—é—á –∑–∞–Ω–æ–≤–æ"
echo "- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—É –∏–∑ –∫–æ–Ω—Å–æ–ª–∏ Vast.ai"