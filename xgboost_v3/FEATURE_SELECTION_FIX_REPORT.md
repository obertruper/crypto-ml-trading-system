# üìä –û—Ç—á–µ—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ Feature Selection –∏ –≤–µ—Å–æ–≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–π

## üîç –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. –í–µ—Å–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π 80/5/10/5 –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ

**–ü—Ä–∏—á–∏–Ω–∞**: –í `feature_selector.py` –º–µ—Ç–æ–¥ `_select_hierarchical` –∏–º–µ–ª –ª–æ–≥–∏—á–µ—Å–∫—É—é –æ—à–∏–±–∫—É:
- –ï—Å–ª–∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –±—ã–ª–æ –º–µ–Ω—å—à–µ —Ü–µ–ª–µ–≤–æ–π –∫–≤–æ—Ç—ã (80%), –∫–æ–¥ –ø—Ä–æ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª —Ç–æ —á—Ç–æ –µ—Å—Ç—å
- –ù–ï –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ –ø–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–≤–æ—Ç –∏–∑ –¥—Ä—É–≥–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π

### 2. –î—É–±–ª–∏—Ä—É—é—â–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–∏

**–ü—Ä–∏—á–∏–Ω–∞**: –í `feature_engineer.py` –º–µ—Ç–æ–¥ `_create_rolling_features` —Å–æ–∑–¥–∞–≤–∞–ª –Ω–æ–≤—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö:
- –ò–∑ –ë–î –∑–∞–≥—Ä—É–∂–∞–ª–∏—Å—å `rsi_val`, `rsi_ma` 
- Feature engineer —Å–æ–∑–¥–∞–≤–∞–ª `rsi_val_ma_10`, `rsi_val_ma_20` –∏ —Ç.–¥.
- –≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

### 3. –ù–µ—Ç–æ—á–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è –ø—Ä–∏–∑–Ω–∞–∫–æ–≤

**–ü—Ä–∏—á–∏–Ω–∞**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å –Ω–µ—á–µ—Ç–∫–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:
- `market_regime_*` –ø–æ–ø–∞–¥–∞–ª–∏ –≤ "other" –≤–º–µ—Å—Ç–æ "technical"
- –ü–∞—Ç—Ç–µ—Ä–Ω—ã —Å–≤–µ—á–µ–π (`consecutive_hh`, `is_hammer`) –º–æ–≥–ª–∏ –ø–æ–ø–∞—Å—Ç—å –≤ "temporal"
- –°–∫–æ–ª—å–∑—è—â–∏–µ —Å—Ä–µ–¥–Ω–∏–µ (`_ma_`, `_std_`) –Ω–µ –≤—Å–µ–≥–¥–∞ –æ–ø—Ä–µ–¥–µ–ª—è–ª–∏—Å—å –∫–∞–∫ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ

### 4. XGBoost –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–ª –∫–≤–æ—Ç—ã –ø—Ä–∏ –æ–±—É—á–µ–Ω–∏–∏

**–ü—Ä–∏—á–∏–Ω–∞**: –î–∞–∂–µ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –æ—Ç–±–æ—Ä–æ–º –ø—Ä–∏–∑–Ω–∞–∫–æ–≤, –º–æ–¥–µ–ª—å –¥–∞–≤–∞–ª–∞ –≤—ã—Å–æ–∫—É—é –≤–∞–∂–Ω–æ—Å—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–º –ø—Ä–∏–∑–Ω–∞–∫–∞–º –∏–∑-–∑–∞ –∏—Ö –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏ —Å —Ü–µ–ª–µ–≤–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π.

## üõ†Ô∏è –í–Ω–µ—Å–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∫–≤–æ—Ç (`utils/feature_selector.py`)

```python
# –¢–µ–ø–µ—Ä—å –µ—Å–ª–∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö < 80%, –¥–æ–±–∏—Ä–∞–µ–º –∏–∑ –¥—Ä—É–≥–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π (–∫—Ä–æ–º–µ temporal!)
if len(technical_features) < n_technical:
    remaining_needed = n_technical - len(technical_features)
    # –ë–µ—Ä–µ–º –ø—Ä–∏–∑–Ω–∞–∫–∏ –∏–∑ btc_related –∏ other, –Ω–æ –ù–ï –∏–∑ temporal
    other_features = importance_df[
        (~importance_df['feature'].isin(selected)) & 
        (importance_df['category'].isin(['btc_related', 'other']))
    ]
```

### 2. –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ (`data/feature_engineer.py`)

```python
# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º
if ma_col not in df.columns:
    df[ma_col] = df[indicator].rolling(window).mean()
    created_rolling += 1
else:
    skipped_rolling += 1
```

### 3. –°–æ–∑–¥–∞–Ω —Ç–æ—á–Ω—ã–π –º–∞–ø–ø–∏–Ω–≥ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ (`config/feature_mapping.py`)

- –Ø–≤–Ω—ã–π —Å–ª–æ–≤–∞—Ä—å –≤—Å–µ—Ö –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
- –§—É–Ω–∫—Ü–∏—è `get_feature_category()` –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- –ü–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã `market_regime_*` –≤ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
- –î–æ–±–∞–≤–ª–µ–Ω—ã –≤—Å–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã —Å–≤–µ—á–µ–π –≤ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ

### 4. –î–æ–±–∞–≤–ª–µ–Ω–∞ –∂–µ—Å—Ç–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–≤–æ—Ç

```python
# –ï—Å–ª–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ > 5%, –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É–¥–∞–ª—è–µ–º –ª–∏—à–Ω–∏–µ
temporal_count = final_counts.get('temporal', 0)
max_temporal = int(self.top_k * 0.05)
if temporal_count > max_temporal:
    # –£–¥–∞–ª—è–µ–º –ª–∏—à–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏
```

### 5. –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤ `main.py`

```python
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ –æ—Ç–±–æ—Ä–∞ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
for category, target_percent in targets.items():
    if deviation > 10:  # –ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ
        logger.warning("‚ö†Ô∏è –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è –æ—Ç —Ü–µ–ª–µ–≤–æ–≥–æ!")
```

## üìà –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏: ~32% –≤–∞–∂–Ω–æ—Å—Ç–∏
- –ü–∞—Ç—Ç–µ—Ä–Ω—ã —Å–≤–µ—á–µ–π: ~23% –≤–∞–∂–Ω–æ—Å—Ç–∏  
- –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã: —Ç–æ–ª—å–∫–æ ~10% –≤–∞–∂–Ω–æ—Å—Ç–∏

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
- **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã: 80%** (–≤–∫–ª—é—á–∞—è –ø–∞—Ç—Ç–µ—Ä–Ω—ã –∏ —Ä–µ–∂–∏–º—ã —Ä—ã–Ω–∫–∞)
- **–í—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏: 5%** (–∂–µ—Å—Ç–∫–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω—ã)
- **BTC –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏: 10%**
- **–°–∏–º–≤–æ–ª—ã/–¥—Ä—É–≥–∏–µ: 5%**

## ‚úÖ –ß—Ç–æ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–ö–≤–æ—Ç—ã —Å–æ–±–ª—é–¥–∞—é—Ç—Å—è –∂–µ—Å—Ç–∫–æ** - –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ –Ω–µ –º–æ–≥—É—Ç –ø—Ä–µ–≤—ã—Å–∏—Ç—å 5%
2. **–î—É–±–ª–∏–∫–∞—Ç—ã –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è** - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º
3. **–¢–æ—á–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è** - —è–≤–Ω—ã–π –º–∞–ø–ø–∏–Ω–≥ –≤—Å–µ—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
4. **–í–∞–ª–∏–¥–∞—Ü–∏—è** - –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –ø—Ä–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–∏ –æ—Ç —Ü–µ–ª–µ–≤—ã—Ö –∫–≤–æ—Ç
5. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–º** - –ø—Ä–∏ –Ω–µ—Ö–≤–∞—Ç–∫–µ –¥–æ–±–∏—Ä–∞–µ–º –∏–∑ –¥—Ä—É–≥–∏—Ö, –Ω–æ –ù–ï –∏–∑ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö

## üöÄ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

1. **–£–≤–µ–ª–∏—á–∏—Ç—å –¥–∞—Ç–∞—Å–µ—Ç** - —á—Ç–æ–±—ã –±—ã–ª–æ –±–æ–ª—å—à–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å sample_weight** - –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Å–Ω–∏–∂–µ–Ω–∏—è –≤–ª–∏—è–Ω–∏—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
3. **–†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å** - —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ —á–µ—Ä–µ–∑ –ª–æ–≥–∏
4. **–û–±–Ω–æ–≤–ª—è—Ç—å –º–∞–ø–ø–∏–Ω–≥** - –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤

## üìù –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:

```bash
# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
python test_feature_selection_fix.py

# –ó–∞–ø—É—Å–∫ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
python main.py --test-mode
```

## ‚ö†Ô∏è –í–∞–∂–Ω–æ–µ –∑–∞–º–µ—á–∞–Ω–∏–µ:

–î–∞–∂–µ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º –ø—Ä–∏–∑–Ω–∞–∫–æ–≤, XGBoost –º–æ–∂–µ—Ç –¥–∞–≤–∞—Ç—å –≤—ã—Å–æ–∫—É—é –≤–∞–∂–Ω–æ—Å—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–º –ø—Ä–∏–∑–Ω–∞–∫–∞–º –µ—Å–ª–∏ –æ–Ω–∏ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –∫–æ—Ä—Ä–µ–ª–∏—Ä—É—é—Ç —Å —Ü–µ–ª–µ–≤–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π. –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –Ω–æ —Ç–µ–ø–µ—Ä—å –∏—Ö –≤–ª–∏—è–Ω–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ–Ω–Ω–æ (–º–∞–∫—Å–∏–º—É–º 5% –æ—Ç –≤—Å–µ—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤).