#!/usr/bin/env python3
"""
–ó–∞–ø—É—Å–∫ —É–ª—É—á—à–µ–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏ XGBoost v3 —Å –Ω–æ–≤—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
"""

import subprocess
import sys
import os

print("="*60)
print("üöÄ –£–õ–£–ß–®–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø XGBoost v3")
print("="*60)
print("\nüìä –ö–õ–Æ–ß–ï–í–´–ï –ò–ó–ú–ï–ù–ï–ù–ò–Ø:")
print("  ‚úÖ –ü–æ—Ä–æ–≥ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏: 1.5% (—Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π –¥–ª—è –∫—Ä–∏–ø—Ç—ã)")
print("  ‚úÖ –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å: max_depth 3-5, —Å–∏–ª—å–Ω–∞—è —Ä–µ–≥—É–ª—è—Ä–∏–∑–∞—Ü–∏—è")
print("  ‚úÖ –ú–µ—Ç—Ä–∏–∫–∞ –æ—Ü–µ–Ω–∫–∏: AUC –≤–º–µ—Å—Ç–æ logloss")
print("  ‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ—Ä–æ–≥–∞: F1-score –≤–º–µ—Å—Ç–æ gmean")
print("  ‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ scale_pos_weight –¥–æ 5")
print("  ‚úÖ –ú–µ–Ω—å—à–∏–π –∞–Ω—Å–∞–º–±–ª—å: 3 –º–æ–¥–µ–ª–∏ –≤–º–µ—Å—Ç–æ 5")
print("  ‚úÖ –£—Å–∏–ª–µ–Ω–Ω—ã–π –æ—Ç–±–æ—Ä —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ (85%)")

print("\nüìà –û–ñ–ò–î–ê–ï–ú–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´:")
print("  ‚Ä¢ ROC-AUC > 0.55 (—Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ –¥–ª—è –∫—Ä–∏–ø—Ç—ã)")
print("  ‚Ä¢ –ú–µ–Ω—å—à–µ —Å–∏–≥–Ω–∞–ª–æ–≤, –Ω–æ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–µ–µ")
print("  ‚Ä¢ –õ—É—á—à–∞—è –≥–µ–Ω–µ—Ä–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö")
print("  ‚Ä¢ –£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ —Ä—ã–Ω–æ—á–Ω–æ–º—É —à—É–º—É")

print("\n‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï:")
print("  ‚Ä¢ –ú–µ—Ç—Ä–∏–∫–∏ –±—É–¥—É—Ç –Ω–∏–∂–µ, –Ω–æ —á–µ—Å—Ç–Ω–µ–µ")
print("  ‚Ä¢ –ú–æ–¥–µ–ª—å –±—É–¥–µ—Ç –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–µ–µ")
print("  ‚Ä¢ –§–æ–∫—É—Å –Ω–∞ –∫–∞—á–µ—Å—Ç–≤–µ, –∞ –Ω–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ —Å–∏–≥–Ω–∞–ª–æ–≤")

print("\n" + "="*60)

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–≤–æ–≥–æ –ø–æ—Ä–æ–≥–∞
print("\nüîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ –∫–ª–∞—Å—Å–æ–≤ —Å –Ω–æ–≤—ã–º –ø–æ—Ä–æ–≥–æ–º...")
subprocess.run([sys.executable, "xgboost_v3/check_new_threshold.py"])

print("\n" + "="*60)

# –ó–∞–ø—Ä–æ—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
response = input("\nüöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –æ–±—É—á–µ–Ω–∏–µ —Å –Ω–æ–≤—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏? (y/n): ")
if response.lower() != 'y':
    print("‚ùå –û—Ç–º–µ–Ω–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º")
    sys.exit(0)

# –ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞
cmd = 'python xgboost_v3/main.py --test-mode --optimize --ensemble-size 3'

print("\nüîß –ó–∞–ø—É—Å–∫–∞–µ–º –æ–±—É—á–µ–Ω–∏–µ...")
print(f"üìå –ö–æ–º–∞–Ω–¥–∞: {cmd}\n")

# –ó–∞–ø—É—Å–∫
try:
    subprocess.run(cmd, shell=True, check=True)
    print("\n‚úÖ –û–±—É—á–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ!")
    print("üìÅ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –ø–∞–ø–∫–µ logs/")
    print("\nüí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:")
    print("  1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ final_report.txt –¥–ª—è –∏—Ç–æ–≥–æ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫")
    print("  2. –ò–∑—É—á–∏—Ç–µ feature importance –≤ metrics.json")
    print("  3. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ confusion matrix –≤ plots/")
    print("  4. –°—Ä–∞–≤–Ω–∏—Ç–µ —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏")
except subprocess.CalledProcessError as e:
    print(f"\n‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏: {e}")
    sys.exit(1)